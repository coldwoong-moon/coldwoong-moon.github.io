{{ printf "<?xml version=\"1.0\" encoding=\"UTF-8\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  {{- range .Data.Pages }}
  {{- if not (in .Site.Params.sitemap.excludedKinds .Kind) }}
  {{- if and (not .Params.private) (not .Params.draft) (not (isset .Params "externalUrl")) }}
  <url>
    <loc>{{ .Permalink }}</loc>
    {{- if or .IsHome (eq .Section "posts") }}
      {{- $validLastmod := and .Lastmod (.Lastmod.Before now) }}
      {{- $validDate := and (not .Date.IsZero) (.Date.Before now) }}
      {{- if $validLastmod }}
    <lastmod>{{ .Lastmod.Format "2006-01-02T15:04:05" | safeHTML }}+09:00</lastmod>
      {{- else if $validDate }}
    <lastmod>{{ .Date.Format "2006-01-02T15:04:05" | safeHTML }}+09:00</lastmod>
      {{- else }}
    <lastmod>{{ now.Format "2006-01-02T15:04:05" | safeHTML }}+09:00</lastmod>
      {{- end }}
    {{- end }}
    {{- if .IsHome }}
    <priority>1.0</priority>
    {{- end }}
  </url>
  {{- end }}
  {{- end }}
  {{- end }}
</urlset>